<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY lua-download-http "https://www.lua.org/ftp/lua-&lua-version;.tar.gz">
  <!ENTITY lua-download-ftp  "">
  <!ENTITY lua-md5sum        "bd8ce7069ff99a400efd14cf339a727b">
  <!ENTITY lua-size          "356Ko">
  <!ENTITY lua-buildsize     "5.8 MB (with Basic tests)">
  <!ENTITY lua-time          "less than 0.1 SBU (with Basic tests)">

  <!ENTITY lua-tests-download-http "https://www.lua.org/tests/lua-&lua-version;-tests.tar.gz">
  <!ENTITY lua-tests-download-ftp  "">
  <!ENTITY lua-tests-md5sum        "0e28a9b48b3596d6b12989d04ae403c4">
  <!ENTITY lua-tests-size          "132Ko">
]>

<sect1 id="lua" xreflabel="Lua-&lua-version;">
  <?dbhtml filename="lua.html"?>


  <title>Lua-&lua-version;</title>

  <indexterm zone="lua">
    <primary sortas="a-Lua">Lua</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introduo a Lua</title>

    <para>
      <application>Lua</application> is a powerful light-weight programming
language designed for extending applications. It is also frequently used as
a general-purpose, stand-alone language. <application>Lua</application> is
implemented as a small library of C functions, written in ANSI C, and
compiles unmodified in all known platforms. The implementation goals are
simplicity, efficiency, portability, and low embedding cost. The result is a
fast language engine with small footprint, making it ideal in embedded
systems too.
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informao do Pacote</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Transferncia (HTTP): <ulink url="&lua-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Transferncia (FTP): <ulink url="&lua-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificao MD5: &lua-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferncia: &lua-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Espao em disco estimado exigido: &lua-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Tempo de construo estimado: &lua-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Transferncias Adicionais</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Required patch: <ulink
url="&patch-root;/lua-&lua-version;-shared_library-2.patch"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Optional Test Suite Download (HTTP): <ulink
url="&lua-tests-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Optional Test Suite Download (FTP): <ulink url="&lua-tests-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Optional Test Suite Download MD5 sum: &lua-tests-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Optional Test Suite Download size: &lua-tests-size;
        </para>
      </listitem>
    </itemizedlist>

    <para condition="html" role="usernotes">Observaes de Usurio(a): <ulink url="&blfs-wiki;/lua"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Instalao de Lua</title>

    <para>
      Some packages check for the <application>pkg-config</application> file for
<application>Lua</application>, which is created with:
    </para>

<screen><userinput>cat &gt; lua.pc &lt;&lt; "EOF"
<literal>V=5.4
R=&lua-version;

prefix=/usr
INSTALL_BIN=${prefix}/bin
INSTALL_INC=${prefix}/include
INSTALL_LIB=${prefix}/lib
INSTALL_MAN=${prefix}/share/man/man1
INSTALL_LMOD=${prefix}/share/lua/${V}
INSTALL_CMOD=${prefix}/lib/lua/${V}
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include

Name: Lua
Description: An Extensible Extension Language
Version: ${R}
Requires:
Libs: -L${libdir} -llua -lm -ldl
Cflags: -I${includedir}</literal>
EOF</userinput></screen>

    <para>
      Instale <application>Lua</application> executando os seguintes comandos:
    </para>

<!-- make MYCFLAGS="-DLUA_COMPAT_5_2 -DLUA_COMPAT_5_1" linux
     The MYCFLAGS="" part was brought into the patch since optimization had to
     be turned off.
     The LUA_ROOT change also has been merged into the patch.-->
<screen><userinput>patch -Np1 -i ../lua-&lua-version;-shared_library-2.patch &amp;&amp;
make linux</userinput></screen>


    <para>
      To test the results, issue: <command>make test</command>.  <quote>This will
run the interpreter and print its version</quote>.  More comprehensive tests
can be performed if you downloaded the "Test suite" tarball. Those tests
need to be executed after the package is installed, thus we defer to the
description below.
    </para>

    <para>
      Agora, como o(a) usurio(a) <systemitem class="username">root</systemitem>:
    </para>

<screen role="root"><userinput>make INSTALL_TOP=/usr                \
     INSTALL_DATA="cp -d"            \
     INSTALL_MAN=/usr/share/man/man1 \
     TO_LIB="liblua.so liblua.so.5.4 liblua.so.&lua-version;" \
     install &amp;&amp;

mkdir -pv                      /usr/share/doc/lua-&lua-version; &amp;&amp;
cp -v doc/*.{html,css,gif,png} /usr/share/doc/lua-&lua-version; &amp;&amp;

install -v -m644 -D lua.pc /usr/lib/pkgconfig/lua.pc</userinput></screen>

    <para>
      Here we describe only the "Basic tests". Untar the tarball and change to the
<filename class="directory">lua-&lua-version;-tests</filename> directory,
then issue <command>lua -e "_U=true" all.lua</command>. If the tests finish
without error, you will see a message containing the string "final OK".
    </para>

    
  <!-- The optimization problem fixed in the patch was identified by running
         the test suite, and ultimately culminated in a SIGBUS error. -->
</sect2>

  

  <!-- Brought into the patch, unneeded
  <sect2 role="commands">

    <title>Command Explanations</title>

    <para>
      <command>sed -i ... src/luaconf.h</command>: This command changes the
      <application>Lua</application> search path to match the install path.
    </para>

    <para>
      <envar>MYCFLAGS="-DLUA_COMPAT_5_2 -DLUA_COMPAT_5_1"</envar>: This
      environment variable includes compatibility layers with Lua 5.1 and 5.2
      in the build.
    </para>

  </sect2>
  -->
<sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Aplicativos Instalados</segtitle>
      <segtitle>Biblioteca Instalada</segtitle>
      <segtitle>Diretrios Instalados</segtitle>

      <seglistitem>
        <seg>
          lua and luac
        </seg>
        <seg>
          liblua.so
        </seg>
        <seg>
          /usr/{lib,share}/lua and /usr/share/doc/lua-&lua-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descries Curtas</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="lua-prog">
        <term><command>lua</command></term>
        <listitem>
          <para>
            is the standalone Lua interpreter
          </para>
          <indexterm zone="lua lua-prog">
            <primary sortas="b-lua">lua</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="luac">
        <term><command>luac</command></term>
        <listitem>
          <para>
            is the Lua compiler
          </para>
          <indexterm zone="lua luac">
            <primary sortas="b-luac">luac</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="liblua">
        <term><filename class="libraryfile">liblua.so</filename></term>
        <listitem>
          <para>
            contains the <application>Lua</application> API functions
          </para>
          <indexterm zone="lua liblua">
            <primary sortas="c-liblua">liblua.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
