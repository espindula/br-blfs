<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

  <!ENTITY mutter-download-http "&gnome-download-http;/mutter/&gnome-43;/mutter-&mutter-version;.tar.xz">
  <!ENTITY mutter-download-ftp  "&gnome-download-ftp;/mutter/&gnome-43;/mutter-&mutter-version;.tar.xz">
  <!ENTITY mutter-md5sum        "aba8f5170a27fe7d24f07a3b2fdf2725">
  <!ENTITY mutter-size          "2,7 MB">
  <!ENTITY mutter-buildsize     "151 MB (sem testes)">
  <!ENTITY mutter-time          "0,6 UPC (Usando paralelismo=4)">
  <!ENTITY mutter-time-systemd  "0,6 UPC (Usando paralelismo=4, adicionar 1,0 UPC para testes)">
]>

<sect1 id="mutter" xreflabel="Mutter-&mutter-version;">
  <?dbhtml filename="mutter.html"?>


  <title>Mutter-&mutter-version;</title>

  <indexterm zone="mutter">
    <primary sortas="a-Mutter">Mutter</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introdução ao Mutter</title>

    <para>
      <application>Mutter</application> é o gerenciador de janelas para o
<application>GNOME</application>. Ele não é invocado diretamente, mas a
partir da <application>Sessão GNOME</application> (em uma máquina com um
controlador de vídeo acelerado por hardware).
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informação do Pacote</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&mutter-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Transferência (FTP): <ulink url="&mutter-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &mutter-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &mutter-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Espaço em disco estimado exigido: &mutter-buildsize;
        </para>
      </listitem>
      <listitem revision='sysv'>
        <para>
          Tempo de construção estimado: &mutter-time;
        </para>
      </listitem>
      <listitem revision='systemd'>
        <para>
          Tempo de construção estimado: &mutter-time-systemd;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependências do Mutter</bridgehead>

    <bridgehead renderas="sect4">Exigidas</bridgehead>
    <para role="required">
      <xref linkend="gnome-settings-daemon"/>, <xref linkend="graphene"/>, <xref
linkend="libxcvt"/>, <xref linkend="libxkbcommon"/> e <xref
linkend="pipewire"/>
    </para>

    <bridgehead renderas="sect4">Recomendadas</bridgehead>
    <para role="recommended">
      <xref linkend="desktop-file-utils"/>, <xref
linkend="gobject-introspection"/>, <xref linkend="startup-notification"/> e
<xref linkend="sysprof"/>
    </para>

    <bridgehead renderas="sect4">Recomendadas (exigidas para construir o compositor Wayland)</bridgehead>
    <para role="recommended">
      <xref linkend="libinput"/>, <xref linkend="wayland"/>, <xref
linkend="wayland-protocols"/> e <xref linkend="xwayland"/>. Adicionalmente,
<xref linkend="gtk3"/> precisa ser construído com suporte a
<application>Wayland</application>.
    </para>

    <bridgehead renderas="sect4"
                revision="sysv">Recomendadas (tempo de execução)</bridgehead>
    <para role="recommended" revision="sysv">
      <xref linkend="blocaled" role="runtime"/>
    </para>

    <bridgehead renderas="sect4">Opcionais</bridgehead>
    <para role="optional">
      <xref linkend="python-dbusmock"/> (exigido para testes), <xref
linkend="xorg-server"/> (para sessões X11)
    </para>

    

    <!-- NOTE: Mutter compiles git versions of COGL and Clutter for it's own
    internal use. This is because the wayland support upstream isn't advanced
    enough for the graphics stack used in Mutter. -->
<para condition="html" role="usernotes">Observações de Usuário(a): <ulink url="&blfs-wiki;/mutter"/>
    </para>

  </sect2>

  <sect2 role="installation">
    <title>Instalação do Mutter</title>

    <para>
      Instale o <application>Mutter</application> executando os seguintes
comandos:
    </para>

<!--
    <para>

      To test the results, issue:
      <command>dbus-run-session ninja test</command>. The tests
      require an active X session to run correctly. It is not necessary to
      run a  separate D-bus session if not in a GNOME session, but it
      provides a clean environment in any case. One test,
      <filename>native-headless</filename>, is known to fail.
    </para>
    -->
<!-- there are no added problems in sysv, AFAICT. Running the tests is
    not easy whatever the init system. But using the instructions below in
    a gnome session on sysv works (no test failure)...
    <para revision='sysv'>

       This package does not come with a test suite that runs properly in the
       SystemV environment.
    </para>
    -->
<screen><userinput>mkdir build &amp;&amp;
cd    build &amp;&amp;

meson --prefix=/usr --buildtype=debugoptimized -Dtests=false .. &amp;&amp;
ninja</userinput></screen>


    

    <para>
      A suíte de teste exige que funções de depuração estejam habilitadas na
construção e um aplicativo externo chamado <command>xvfb-run</command>. Se
desejar executar os testes, você deveria baixá-lo e instalá-lo antes de
executar o <command>meson</command>. Você pode obtê-lo a partir de <ulink
url="&sources-anduin-http;/mutter/xvfb-run">xvfb-run</ulink> e instalá-lo
com permissões executáveis em <filename
class="directory">/usr/bin</filename>. <command>xvfb-run</command> precisa
de <command>Xvfb</command> em tempo de execução, e <command>Xvfb</command>
pode ser instalado a partir de <xref linkend='xorg-server'/> ou <xref
linkend='xwayland'/>. Você também deveria substituir
<parameter>-Dtests=false</parameter> no comando <command>meson</command> por
<parameter>-Dtests=true</parameter>. A suíte de teste exige que o esquema
mutter esteja instalado no sistema, de forma que é melhor executar os testes
depois de instalar o pacote.
    </para>

    <para>
      Você também pode testar funções básicas do <application>Mutter</application>
seguindo <xref linkend='mutter-starting'/>, depois de instalá-lo.
    </para>

    <para>
      Agora, como o(a) usuário(a) <systemitem class="username">root</systemitem>:
    </para>

<screen role="root"><userinput>ninja install</userinput></screen>

    <para>
      Se você deseja executar os testes, remova a referência ao
<application>Zenity</application>, que não faz parte do BLFS, de um teste:
    </para>

<screen role='test'><userinput>sed 's/zenity --[a-z]*/gtk3-demo/' -i ../src/tests/x11-test.sh</userinput></screen>

    <para>
      Agora execute a suíte de teste:
    </para>

    
<screen role='test'><!-- Without "HOME=" one test can fail with certain monitor
         configuration in $HOME/.config/monitors.xml. -->
<userinput>HOME= ninja test</userinput></screen>

    <para>
      Os testes exigem uma sessão ativa do X ou wayland. O teste
<filename>native-unit</filename> é conhecido por falhar. Muitos testes
falharão se a renderização do opengl não for feita no hardware. Não faça
nenhuma entrada de mouse ou teclado enquanto a suíte de teste estiver
executando ou alguns testes poderão falhar.
    </para>
  </sect2>

  <sect2 role="commands">
    <title>Explicações do Comando</title>

    
    <!-- https://gitlab.gnome.org/GNOME/gnome-shell/-/issues/5512
         If debug is disabled, the "assertion 'CLUTTER_IS_ACTOR (self)'
         failed" message will turn into a crash.  Enabling debug is just a
         work around, it's not a proper fix.  -->
<para>
      <parameter>--buildtype=debugoptimized</parameter>: Substitui o tipo de
construção padrão (<quote>debug</quote>), o que produziria binários não
otimizados. É usado em vez de <option>--buildtype=release</option> para
contornar um problema que causa o travamento do gnome-shell.
    </para>

    <!--
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
      href="../../xincludes/meson-buildtype-release.xml"/>

-->
<para>
      <parameter>-Dtests=false</parameter>: Impede a construção dos testes e
remove um requisito difícil em <command>xvfb-run</command>.
    </para>

    <para>
      <option>-Dprofiler=false</option>: Use essa opção se o
<application>Sysprof</application> não estiver instalado e você não quiser
que o meson baixe o código fonte do <application>Sysprof</application>.
    </para>

  </sect2>

  <sect2 role="starting" id="mutter-starting">
    <title>Iniciando o Mutter</title>

    

    <!-- Mutter as a Wayland compositor Works with mutter-42.4 and 43.0.
         IIRC mutter can also be used as a X window manager: just replace
         "twm" with "mutter &dash;&dash;x11" in xinitrc. But I've not tested
         such a configuration recently (I don't build Xorg Server or xinit
         these days.  -->
<para>
      <application>Mutter</application> normalmente é usado como um componente do
<application>gnome-shell</application>, mas também pode ser usado como um
compositor autônomo Wayland. Para executar <application>Mutter</application>
como um compositor Wayland, em um console virtual, emita:
    </para>

    <screen role='nodump'><userinput>mutter --wayland -- vte-2.91</userinput></screen>

    <para>
      Substitua <command>vte-2.91</command> pela linha de comando do primeiro
aplicativo que você deseja na sessão do Wayland. Observe que assim que esse
aplicativo sair, a sessão do Wayland será terminada.
    </para>

    <para>
      <application>Mutter</application> também pode funcionar como um compositor
aninhado em outra sessão do Wayland. Em um emulador de terminal, emita:
    </para>

    <screen role='nodump'><userinput>MUTTER_DEBUG_DUMMY_MODE_SPECS=1920x1080 mutter --wayland --nested -- vte-2.91</userinput></screen>

    <para>
      Substitua <replaceable>1920x1080</replaceable> pelo tamanho que você quiser
para a sessão aninhada do Wayland.
    </para>
  </sect2>

  <sect2 role="content">
    <title>Conteúdo</title>

    <segmentedlist>
      <segtitle>Aplicativos Instalados</segtitle>
      <segtitle>Bibliotecas Instaladas</segtitle>
      <segtitle>Diretórios Instalados</segtitle>

      <seglistitem>
        <seg>
          mutter
        </seg>
        <seg>
          libmutter-11.so
        </seg>
        <seg>
          /usr/{lib,include,libexec/installed-tests,share/{,installed-tests}}/mutter-11
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descrições Curtas</bridgehead>
      <?dbfo list-presentation="list"?> <?dbhtml list-presentation="table"?>

      <varlistentry id="mutter-prog">
        <term><command>mutter</command></term>
        <listitem>
          <para>
            é um gerenciador de janelas de composição <application>GTK+</application>
baseado em <application>Clutter</application>
          </para>
          <indexterm zone="mutter mutter-prog">
            <primary sortas="b-mutter">mutter</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libmutter">
        <term><filename class="libraryfile">libmutter-11.so</filename></term>
        <listitem>
          <para>
            contém as funções da API do <application>Mutter</application>
          </para>
          <indexterm zone="mutter libmutter">
            <primary sortas="c-libmutter">libmutter-11.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
