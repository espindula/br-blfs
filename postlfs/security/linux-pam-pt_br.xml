<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

<!--

Direitos autorais (Copyright) da versão modificada traduzida para a 
língua portuguesa escrita e falada no Brasil: (c) 2022, 2023 Jamenson 
Ferreira Espindula de Almeida Melo (<jafesp@gmail.com>).

  Este trabalho de tradução do livro "Beyond Linux From Scratch" é 
  classificado pela Free Software Foundation como sendo uma "versão 
  modificada" do mencionado livro.  Em assim sendo, na qualidade de 
  tradutor, produtor da "versão modificada" e titular dos direitos 
  autorais sobre a versão traduzida para a língua portuguesa do livro 
  "Beyond Linux From Scratch", concede-se a seguinte permissão:

  É concedida permissão para copiar, distribuir e (ou) modificar este 
  livro "Beyond Linux From Scratch", versão traduzida para a língua 
  portuguesa, sob os termos da Licença de Documentação Livre GNU, versão 
  1.3 ou qualquer versão posterior publicada pela Free Software 
  Foundation; sem Seções Invariantes, sem Textos de Capa Frontal e sem 
  Textos de Quarta Capa.  Uma cópia da licença está incluída na seção 
  intitulada "Licença de Documentação Livre GNU".
  
# Atenção: todos os documentos aqui publicados são distribuídos sem qualquer garantia, implícita e (ou) explícita.
  
  Permission is granted to copy, distribute and (or) modify this book 
  "Beyond Linux From Scratch", translated into Brazilian Portuguese, 
  under the terms of the GNU Free Documentation License, Version 1.3 or 
  any later version published by the Free Software Foundation; with no 
  Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A 
  copy of the license is included in the section entitled "GNU Free 
  Documentation License".

# Warning: all the files herein published are released with no warranty, implicit and (or) explicit.

-->

  <!ENTITY linux-pam-download-http "https://github.com/linux-pam/linux-pam/releases/download/v&linux-pam-version;/Linux-PAM-&linux-pam-version;.tar.xz">
  <!ENTITY linux-pam-download-ftp  " ">
  <!ENTITY linux-pam-md5sum        "895e8adfa14af334f679bbeb28503f66">
  <!ENTITY linux-pam-size          "966 KB">
  <!ENTITY linux-pam-buildsize     "39 MB (com os testes)">
  <!ENTITY linux-pam-time          "0,4 UPC (com os testes)">

  <!ENTITY linux-pam-docs-download "https://github.com/linux-pam/linux-pam/releases/download/v&linux-pam-version;/Linux-PAM-&linux-pam-docs-version;-docs.tar.xz">
  <!ENTITY linux-pam-docs-md5sum   "ceb3dc248cb2f49a40904b93cb91db1b">
  <!ENTITY linux-pam-docs-size     "433 KB">
  <!--
  <!ENTITY debian-pam-docs         "http://debian.securedservers.com/kernel/pub/linux/libs/pam">
  -->
]>

<sect1 id="linux-pam" xreflabel="Linux-PAM-&linux-pam-version;">
  <?dbhtml filename="linux-pam-pt_br.html"?>

  <sect1info>
    <date>$Date$</date>
  </sect1info>

  <title>Linux-PAM-&linux-pam-version;</title>

  <indexterm zone="linux-pam">
    <primary sortas="a-Linux-PAM">Linux-PAM</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introdução ao Linux PAM</title>

    <para>

      O pacote <application>Linux PAM</application> contém os Módulos 
      Plugáveis de Autenticação usados para habilitar o(a) 
      administrador(a) local do sistema a escolher como os aplicativos 
      autenticam os(as) usuários(as).

    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informação do Pacote</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&linux-pam-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Transferência (FTP): <ulink url="&linux-pam-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &linux-pam-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &linux-pam-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Espaço em disco estimado exigido: &linux-pam-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Tempo de construção exigido: &linux-pam-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Transferências Adicionais</bridgehead>
    <itemizedlist spacing="compact">
    <title>Documentação Opcional</title>
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&linux-pam-docs-download;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &linux-pam-docs-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &linux-pam-docs-size;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependências do Linux PAM</bridgehead>

    <bridgehead renderas="sect4">Opcionais</bridgehead>
    <para role="optional">
      <xref linkend="db"/>,
      <xref linkend="libnsl"/>,
      <xref linkend="libtirpc"/>,
      <ulink url="https://github.com/linux-audit/audit-userspace">libaudit</ulink> e
      <ulink url="http://www.prelude-siem.org">Prelude</ulink>
    </para>

    <bridgehead renderas="sect4">Opcionais (Para Reconstruir a Documentação)</bridgehead>
    <para role="optional">
      <xref linkend="DocBook"/>,
      <xref linkend="docbook-xsl"/>,
      <xref linkend="fop"/>,
      <xref linkend="libxslt"/> e ou
      <xref linkend="lynx"/> ou
      <ulink url="&w3m-url;">W3m</ulink>
    </para>

    <note>

      <para role="required">

        O <xref role="runtime" linkend="shadow"/>
<phrase revision="systemd"> e o <xref role="runtime" linkend="systemd"/> precisam ser reinstalados</phrase>
<phrase revision="sysv">precisa ser reinstalado</phrase>
        depois de instalar e de configurar o <application>Linux PAM</application>.

      </para>

      <para role="recommended">

        Com o Linux-PAM-1.4.0 e superiores, o módulo pam_cracklib não é 
        instalado por padrão.  Para impor senhas fortes, é recomendado 
        usar-se a <xref role="runtime" linkend="libpwquality"/>.

      </para>

    </note>

    <para condition="html" role="usernotes">Observação de Usuário(a):
      <ulink url="&blfs-wiki;/linux-pam"/>
    </para>
  </sect2>

  <sect2 role="installation">
    <title>Instalação do Linux PAM</title>

    <para revision="sysv">

      Primeiro, evite a instalação de um arquivo desnecessário do 
      systemd:

    </para>

<screen revision="sysv"><userinput>sed -e /service_DATA/d \
    -i modules/pam_namespace/Makefile.am &amp;&amp;
autoreconf</userinput></screen>

    <para>

      Se você transferiu a documentação, [então] desempacote o tarball 
      executando o seguinte comando.

    </para>

<screen><userinput>tar -xf ../Linux-PAM-&linux-pam-docs-version;-docs.tar.xz --strip-components=1</userinput></screen>

    <para>

      Se, em vez disso, você quiser regerar a documentação, [então] 
      corrija o script <command>configure</command>, de forma que ele 
      detecte o lynx se instalado:

    </para>

<screen><userinput>sed -e 's/dummy elinks/dummy lynx/'                                    \
    -e 's/-no-numbering -no-references/-force-html -nonumbers -stdin/' \
    -i configure</userinput></screen>

    <para>

      Instale o <application>Linux PAM</application> executando os 
      seguintes comandos:

    </para>

<screen><userinput>./configure --prefix=/usr                        \
            --sbindir=/usr/sbin                  \
            --sysconfdir=/etc                    \
            --libdir=/usr/lib                    \
            --enable-securedir=/usr/lib/security \
            --docdir=/usr/share/doc/Linux-PAM-&linux-pam-version; &amp;&amp;
make</userinput></screen>

    <para>

      Para testar os resultados, um arquivo de configuração 
      <filename>/etc/pam.d/other</filename> adequado precisa existir.

    </para>

    <caution>

      <title>Reinstalação ou atualização do Linux PAM</title>

      <para>

        Se você tiver um sistema com o Linux PAM instalado e 
        funcionando, [então] seja cuidadoso(a) quando modificar os 
        arquivos em <filename class="directory">/etc/pam.d</filename>, 
        dado que o seu sistema possivelmente se torne totalmente 
        inutilizável.  Se você quiser executar os testes, [então] você 
        não precisa criar outro arquivo 
        <filename>/etc/pam.d/other</filename>.  Aquele instalado pode 
        ser usado para esse propósito.

      </para>

      <para>

        Você também deveria estar ciente de que
<command>make install</command> sobrescreve os arquivos de configuração em 
        <filename class="directory">/etc/security</filename>, assim como 
        o <filename>/etc/environment</filename>.  No caso de você tiver 
        modificado aqueles arquivos, tenha certeza de produzir uma cópia 
        de segurança deles.

      </para>

    </caution>

    <para>

      Para uma primeira instalação, crie o arquivo de configuração 
      executando os seguintes comandos como o(a) usuário(a)
<systemitem class="username">root</systemitem>:

    </para>

<screen role="root"><userinput>install -v -m755 -d /etc/pam.d &amp;&amp;

cat &gt; /etc/pam.d/other &lt;&lt; "EOF"
<literal>auth     required       pam_deny.so
account  required       pam_deny.so
password required       pam_deny.so
session  required       pam_deny.so</literal>
EOF</userinput></screen>

    <para>

      Agora execute os testes emitindo <command>make check</command>.  
      Assegure-se de que não existem erros produzidos pelos testes antes 
      de continuar a instalação.  Observe que as verificações são 
      bastante longas.  Possivelmente seja útil redirecionar a saída 
      gerada para um arquivo de registro para a finalidade de 
      inspecioná-lo cuidadosamente.

    </para>

    <para>

      Somente no caso de uma primeira instalação, remova o arquivo de 
      configuração criado anteriormente emitindo o seguinte comando como 
      o(a) usuário(a) <systemitem class="username">root</systemitem>:

    </para>

<screen role="root"><userinput>rm -fv /etc/pam.d/other</userinput></screen>

    <para>

      Agora, como o(a) usuário(a)
<systemitem class="username">root</systemitem>:

    </para>

<screen role="root"><userinput>make install &amp;&amp;
chmod -v 4755 /usr/sbin/unix_chkpwd</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explicações do Comando</title>

    <para>

      <parameter>--enable-securedir=/usr/lib/security</parameter>:
      Essa chave configura o local da instalação para os módulos do 
      <application>PAM</application>.

    </para>

    <para>

      <option>--disable-regenerate-docu</option> : Se as dependências 
      necessárias (<xref linkend="DocBook"/>;
<xref linkend="docbook-xsl"/>; <xref linkend="libxslt"/>; e
<xref linkend="lynx"/> ou o <ulink url="&w3m-url;">W3m</ulink>) 
      estiverem instaladas, [então] as páginas de manual e as 
      documentações html e de texto serão (re)geradas e instaladas.  
      Além disso, se o <xref linkend="fop"/> estiver instalado, [então] 
      a documentação PDF será gerada e instalada.  Use essa chave se 
      você não quiser reconstruir a documentação.

    </para>

    <para>

      <command>chmod -v 4755 /usr/sbin/unix_chkpwd</command>:
      O aplicativo auxiliar <command>unix_chkpwd</command> precisa ser 
      setuid, de forma que processos não
<systemitem class="username">root</systemitem> possam acessar o arquivo 
      sombra.

    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configurando o Linux-PAM</title>

    <sect3 id="pam-config">
      <title>Arquivos de Configuração</title>

      <para>

        <filename>/etc/security/*</filename> e 
        <filename>/etc/pam.d/*</filename>

      </para>

      <indexterm zone="linux-pam pam-config">
        <primary sortas="e-etc-security">/etc/security/*</primary>
      </indexterm>

      <indexterm zone="linux-pam pam-config">
        <primary sortas="e-etc-pam.d">/etc/pam.d/*</primary>
      </indexterm>

    </sect3>

    <sect3>
      <title>Informação de Configuração</title>

      <para>

        A informação de configuração é colocada em
<filename class="directory">/etc/pam.d/</filename>.  Abaixo está um 
        exemplo:

      </para>

<screen><literal># Início do /etc/pam.d/other

auth            required        pam_unix.so     nullok
account         required        pam_unix.so
session         required        pam_unix.so
password        required        pam_unix.so     nullok

# Fim do /etc/pam.d/other</literal></screen>

      <para>

        Agora configure alguns arquivos genéricos.  Como o(a) usuário(a) 
        <systemitem class="username">root</systemitem>:

      </para>

<screen role="root"><userinput>install -vdm755 /etc/pam.d &amp;&amp;
cat &gt; /etc/pam.d/system-account &lt;&lt; "EOF" &amp;&amp;
<literal># Início do /etc/pam.d/system-account

account   required    pam_unix.so

# Fim do /etc/pam.d/system-account</literal>
EOF

cat &gt; /etc/pam.d/system-auth &lt;&lt; "EOF" &amp;&amp;
<literal># Início do /etc/pam.d/system-auth

auth      required    pam_unix.so

# Fim do /etc/pam.d/system-auth</literal>
EOF

cat &gt; /etc/pam.d/system-session &lt;&lt; "EOF"
<literal># Início do /etc/pam.d/system-session

session   required    pam_unix.so

# Fim do /etc/pam.d/system-session</literal>
EOF
cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Início do /etc/pam.d/system-password


# use o hash sha512 para encriptação; use sombra e tente usar algum 
# token de autenticação previamente definido (senha escolhida) 
# configurado por algum módulo anterior
password  required    pam_unix.so       sha512 shadow try_first_pass

# Fim do /etc/pam.d/system-password</literal>
EOF
</userinput></screen>

     <para>

       Se você desejar habilitar o suporte a senha forte, [então] 
       instale a <xref linkend="libpwquality"/> e siga as instruções 
       naquela página para configurar o módulo do PAM pam_pwquality com 
       o suporte a senha forte.

     </para>

<!-- 

     Com a remoção do módulo pam_cracklib, supõe-se que nós estaremos 
     usando a libpwquality.  Essa já inclui instruções na página de 
     informação de configuração dela, de forma que nós usaremos aquelas 
     em vez.

     O Linux-PAM precisa ser instalado antes da libpwquality, de forma 
     que o suporte PAM seja construído internamente e o módulo PAM seja 
     construído.

-->

<!--

      <para>

        O arquivo genérico restante depende se o
<xref linkend="cracklib"/> estiver instalado.  Se estiver instalado,
        [então] use:

      </para>

<screen role="root"><userinput>cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Início do /etc/pam.d/system-password

# verifique novas senhas quanto à força (man pam_cracklib)
password  required    pam_cracklib.so    authtok_type=UNIX retry=1 difok=5 \
                                         minlen=9 dcredit=1 ucredit=1 \
                                         lcredit=1 ocredit=1 minclass=0 \
                                         maxrepeat=0 maxsequence=0 \
                                         maxclassrepeat=0 \
                                         dictpath=/lib/cracklib/pw_dict
# use o hash sha512 para encriptação; use sombra e use o token de 
# autenticação (senha escolhida) configurado por pam_cracklib acima (ou 
# quaisquer módulos anteriores)
password  required    pam_unix.so        sha512 shadow use_authtok

# Fim do /etc/pam.d/system-password</literal>
EOF</userinput></screen>

      <note>

        <para>

          Na configuração padrão dele, pam_cracklib permitirá múltiplas 
          senhas consideradas as letras maiúsculas e as minúsculas tão 
          curtas quanto seis (06) caracteres, mesmo com o valor de 
          <parameter>minlen</parameter> configurado para onze (11).  
          Você deveria rever a página de manual pam_cracklib(8) e 
          determinar se esses valores padrão são aceitáveis para a 
          segurança do seu sistema.

        </para>

      </note>

      <para>

        Se <xref linkend="cracklib"/> <emphasis>NÃO</emphasis> estiver 
        instalado, [então] use:

      </para>

<screen role="nodump"><userinput>cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"
<literal># Início do /etc/pam.d/system-password
# use o hash sha512 para encriptação; use sombra e tente usar algum 
# token de autenticação previamente definido (senha escolhida) 
# configurado por algum módulo anterior
password  required    pam_unix.so       sha512 shadow try_first_pass

# Fim do /etc/pam.d/system-password</literal>
EOF</userinput></screen>

-->

      <para>

        Agora acrescente um arquivo de configuração 
        <filename>/etc/pam.d/other</filename> restritivo.  Com esse 
        arquivo, aplicativos que sejam cientes do PAM não executarão, a 
        menos que um arquivo de configuração especificamente para esse 
        aplicativo seja criado.

      </para>

<screen role="root"><userinput>cat &gt; /etc/pam.d/other &lt;&lt; "EOF"
<literal># Início do /etc/pam.d/other

auth        required        pam_warn.so
auth        required        pam_deny.so
account     required        pam_warn.so
account     required        pam_deny.so
password    required        pam_warn.so
password    required        pam_deny.so
session     required        pam_warn.so
session     required        pam_deny.so

# Fim do /etc/pam.d/other</literal>
EOF</userinput></screen>

      <para>

        A página de manual do <application>PAM</application> 
        (<command>man pam</command>) fornece um bom ponto de partida 
        para as descrições dos campos e para as entradas permissíveis.  
        O
<ulink url="http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_SAG.html">Guia
Linux-PAM do(a) Administrador(a) do Sistema</ulink> é 
        recomendado para informação adicional.

      </para>

      <important>

        <para>

          Você agora deveria reinstalar
<phrase revision="sysv">o pacote</phrase>
<phrase revision="systemd">os pacotes</phrase>
<xref linkend="shadow"/>
<phrase revision="systemd"> e <xref linkend="systemd"/></phrase>.

        </para>

      </important>

    </sect3>

  </sect2>

  <sect2 role="content">
    <title>Contents</title>

    <segmentedlist>
      <segtitle>Installed Program</segtitle>
      <segtitle>Installed Libraries</segtitle>
      <segtitle>Installed Directories</segtitle>

      <seglistitem>
        <seg>
          faillock, mkhomedir_helper, pam_namespace_helper,
          pam_timestamp_check, pwhistory_helper, unix_chkpwd and
          unix_update
        </seg>
        <seg>
          libpam.so, libpamc.so and libpam_misc.so
        </seg>
        <seg>
          /etc/security,
          /usr/lib/security,
          /usr/include/security and
          /usr/share/doc/Linux-PAM-&linux-pam-version;
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Short Descriptions</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="faillock">
        <term><command>faillock</command></term>
        <listitem>
          <para>
            displays and modifies the authentication failure record files
          </para>
          <indexterm zone="linux-pam faillock">
            <primary sortas="b-faillock">faillock</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="mkhomedir_helper">
        <term><command>mkhomedir_helper</command></term>
        <listitem>
          <para>
            is a helper binary that creates home directories
          </para>
          <indexterm zone="linux-pam mkhomedir_helper">
            <primary sortas="b-mkhomedir_helper">mkhomedir_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pam_namespace_helper">
        <term><command>pam_namespace_helper</command></term>
        <listitem>
          <para>
            is a helper program used to configure a private namespace for a
            user session
          </para>
          <indexterm zone="linux-pam pam_namespace_helper">
            <primary sortas="b-pam_namespace_helper">pam_namespace_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pwhistory_helper">
        <term><command>pwhistory_helper</command></term>
        <listitem>
          <para>
            is a helper program that transfers password hashes from passwd or
            shadow to opasswd
          </para>
          <indexterm zone="linux-pam pwhistory_helper">
            <primary sortas="b-pwhistory_helper">pwhistory_helper</primary>
          </indexterm>
        </listitem>
      </varlistentry>
<!-- Removed with the removal of the pam_tally{,2} module
      <varlistentry id="pam_tally">
        <term><command>pam_tally</command></term>
        <listitem>
          <para>
            is used to interrogate and manipulate the login counter file.
          </para>
          <indexterm zone="linux-pam pam_tally">
            <primary sortas="b-pam_tally">pam_tally</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="pam_tally2">
        <term><command>pam_tally2</command></term>
        <listitem>
          <para>
            is used to interrogate and manipulate the login counter file, but
            does not have some limitations that <command>pam_tally</command>
            does.
          </para>
          <indexterm zone="linux-pam pam_tally2">
            <primary sortas="b-pam_tally2">pam_tally2</primary>
          </indexterm>
        </listitem>
      </varlistentry>
-->

      <varlistentry id="pam_timestamp_check">
        <term><command>pam_timestamp_check</command></term>
        <listitem>
          <para>
            is used to check if the default timestamp is valid
          </para>
          <indexterm zone="linux-pam pam_timestamp_check">
            <primary sortas="b-pam_timestamp_check">pam_timestamp_check</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unix_chkpwd">
        <term><command>unix_chkpwd</command></term>
        <listitem>
          <para>
            is a helper binary that verifies the password of the current user
          </para>
          <indexterm zone="linux-pam unix_chkpwd">
            <primary sortas="b-unix_chkpwd">unix_chkpwd</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="unix_update">
        <term><command>unix_update</command></term>
        <listitem>
          <para>
            is a helper binary that updates the password of a given user
          </para>
          <indexterm zone="linux-pam unix_update">
            <primary sortas="b-unix_update">unix_update</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="libpam">
        <term><filename class="libraryfile">libpam.so</filename></term>
        <listitem>
          <para>
            provides the interfaces between applications and the
            PAM modules
          </para>
          <indexterm zone="linux-pam libpam">
            <primary sortas="c-libpam">libpam.so</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
