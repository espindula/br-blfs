<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;

<!--

Direitos autorais (Copyright) da versão modificada traduzida para a 
língua portuguesa escrita e falada no Brasil: (c) 2022, 2023 Jamenson 
Ferreira Espindula de Almeida Melo (<jafesp@gmail.com>).

  Este trabalho de tradução do livro "Beyond Linux From Scratch" é 
  classificado pela Free Software Foundation como sendo uma "versão 
  modificada" do mencionado livro.  Em assim sendo, na qualidade de 
  tradutor, produtor da "versão modificada" e titular dos direitos 
  autorais sobre a versão traduzida para a língua portuguesa do livro 
  "Beyond Linux From Scratch", concede-se a seguinte permissão:

  É concedida permissão para copiar, distribuir e (ou) modificar este 
  livro "Beyond Linux From Scratch", versão traduzida para a língua 
  portuguesa, sob os termos da Licença de Documentação Livre GNU, versão 
  1.3 ou qualquer versão posterior publicada pela Free Software 
  Foundation; sem Seções Invariantes, sem Textos de Capa Frontal e sem 
  Textos de Quarta Capa.  Uma cópia da licença está incluída na seção 
  intitulada "Licença de Documentação Livre GNU".
  
# Atenção: todos os documentos aqui publicados são distribuídos sem qualquer garantia, implícita e (ou) explícita.
  
  Permission is granted to copy, distribute and (or) modify this book 
  "Beyond Linux From Scratch", translated into Brazilian Portuguese, 
  under the terms of the GNU Free Documentation License, Version 1.3 or 
  any later version published by the Free Software Foundation; with no 
  Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A 
  copy of the license is included in the section entitled "GNU Free 
  Documentation License".

# Warning: all the files herein published are released with no warranty, implicit and (or) explicit.

-->

  <!ENTITY cryptsetup-download-http "&kernel-dl;/linux/utils/cryptsetup/v&cryptsetup-minor;/cryptsetup-&cryptsetup-version;.tar.xz">
  <!ENTITY cryptsetup-download-ftp  " ">
  <!ENTITY cryptsetup-md5sum        "2303d57e78d4977344188a46e125095c">
  <!ENTITY cryptsetup-size          "11 MB">
  <!ENTITY cryptsetup-buildsize     "29 MB (acrescente 5 MB para os testes)">
  <!ENTITY cryptsetup-time          "0,2 UPC (acrescente 19 UPC para os testes)">
]>

<sect1 id="cryptsetup" xreflabel="cryptsetup-&cryptsetup-version;">
  <?dbhtml filename="cryptsetup-pt_br.html"?>

  <sect1info>
    <date>$Date$</date>
  </sect1info>

  <title>cryptsetup-&cryptsetup-version;</title>

  <indexterm zone="cryptsetup">
    <primary sortas="a-cryptsetup">cryptsetup</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introdução ao cryptsetup</title>

    <para>

      O cryptsetup é usado para configurar encriptação transparente de 
      dispositivos de bloco usando a API de criptografia do kernel.

    </para>

    &lfs111_checked;

    <bridgehead renderas="sect3">Informação do Pacote</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&cryptsetup-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Transferência (FTP): <ulink url="&cryptsetup-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da Transferência: &cryptsetup-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &cryptsetup-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Espaço em disco estimado exigido: &cryptsetup-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Tempo de construção estimado: &cryptsetup-time;
        </para>
      </listitem>
    </itemizedlist>

<!-- Não mais necessário com 2.3.2.
    <bridgehead renderas="sect3">Transferências Adicionais</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Remendo exigido:
          <ulink url="&patch-root;/cryptsetup-&cryptsetup-version;-upstream_fixes-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>
-->

    <bridgehead renderas="sect3">Dependências do cryptsetup</bridgehead>

    <bridgehead renderas="sect4">Exigidas</bridgehead>
    <para role="required">
      <xref linkend="json-c"/>, <xref linkend="lvm2"/> e
      <xref linkend="popt"/>
    </para>

    <bridgehead renderas="sect4">Opcionais</bridgehead>
    <para role="optional">
      <xref linkend="libpwquality"/>,
      <ulink url="https://github.com/P-H-C/phc-winner-argon2">argon2</ulink>, 
      <ulink url="http://www.libssh.org/">libssh</ulink> e
      <ulink url="http://www.openwall.com/passwdqc/">passwdqc</ulink>
    </para>


    <para condition="html" role="usernotes">Observações de Usuário(a):
      <ulink url="&blfs-wiki;/cryptsetup"/>
    </para>
  </sect2>

  <sect2 role="kernel" id="cryptsetup-kernel">
    <title>Configuração do Kernel</title>

    <para>

      Dispositivos de bloco encriptados exigem o suporte de kernel.  
      Para usá-lo, os parâmetros de configuração apropriados do kernel 
      precisam estar configurados:

    </para>

<screen><literal>Device Drivers  ---&gt;
  [*] Multiple devices driver support (RAID and LVM) ---&gt; [CONFIG_MD]
       &lt;*/M&gt; Device mapper support                        [CONFIG_BLK_DEV_DM]
       &lt;*/M&gt; Crypt target support                         [CONFIG_DM_CRYPT]

Cryptographic API  ---&gt;
  &lt;*/M&gt; XTS support                                       [CONFIG_CRYPTO_XTS]
  &lt;*/M&gt; SHA224 and SHA256 digest algorithm                [CONFIG_CRYPTO_SHA256]
  &lt;*/M&gt; AES cipher algorithms                             [CONFIG_CRYPTO_AES]
  &lt;*/M&gt; User-space interface for symmetric key cipher algorithms
                                                          [CONFIG_CRYPTO_USER_API_SKCIPHER]
  For tests:
  &lt;*/M&gt; Twofish cipher algorithm                          [CONFIG_CRYPTO_TWOFISH]</literal></screen>

    <indexterm zone="cryptsetup cryptsetup-kernel">
      <primary sortas="d-cryptsetup">cryptsetup</primary>
    </indexterm>

  </sect2>

    <sect2 role="installation">
      <title>Instalação do cryptsetup</title>

<!-- Não mais necessário com 2.3.2

    <para>

      Primeiro, aplique um remendo para corrigir um problema de 
      construção causado pelas mudanças da API em
      <xref role="nodep" linkend="json-c"/>:

    </para>

<screen><userinput remap="pre">patch -Np1 -i ../cryptsetup-&cryptsetup-version;-upstream_fixes-1.patch</userinput></screen>
-->

    <para>

      Instale o <application>cryptsetup</application> executando os 
      seguintes comandos:

    </para>

<screen><userinput>./configure --prefix=/usr --disable-ssh-token &amp;&amp;
make</userinput></screen>

    <para>

      Para testar o resultado, emita como o(a) usuário(a)
      <systemitem class="username">root</systemitem>:
      <command>make check</command>.  Alguns testes falharão se as
      opções de configuração apropriadas do 
      kernel não estiverem configuradas.  Algumas opções adicionais que 
      possivelmente sejam necessárias para os testes são:
      CONFIG_SCSI_LOWLEVEL,
      CONFIG_SCSI_DEBUG,
      CONFIG_BLK_DEV_DM_BUILTIN,
      CONFIG_CRYPTO_USER,
      CONFIG_CRYPTO_CRYPTD,
      CONFIG_CRYPTO_LRW,
      CONFIG_CRYPTO_XTS,
      CONFIG_CRYPTO_ESSIV,
      CONFIG_CRYPTO_CRCT10DIF,
      CONFIG_CRYPTO_AES_TI,
      CONFIG_CRYPTO_AES_NI_INTEL,
      CONFIG_CRYPTO_BLOWFISH,
      CONFIG_CRYPTO_CAST5,
      CONFIG_CRYPTO_SERPENT,
      CONFIG_CRYPTO_SERPENT_SSE2_X86_64,
      CONFIG_CRYPTO_SERPENT_AVX_X86_64,
      CONFIG_CRYPTO_SERPENT_AVX2_X86_64 e
      CONFIG_CRYPTO_TWOFISH_X86_64.

      <!--Eu tive 1 de 21 falhas de testes com as opções de criptografia 
      acima no kernel.  Oito testes não foram executados.  Versão 2.4.3.  
      O teste falho foi tcrypt-compat-test
      tcrypt-images/tc_1-ripemd160-cbc-aes [FAILED]
      bdubbs -->

    </para>

    <para>

      Agora, como o(a) usuário(a) <systemitem class="username">root</systemitem>:

    </para>

<screen role="root"><userinput>make install</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explicações do Comando</title>

    <para>

      <option>--disable-ssh-token</option>: Essa opção é exigida se a 
      dependência opcional libssh não estiver instalada.

    </para>

  </sect2>

  <sect2 role="configuration">
    <title>Configurando o cryptsetup</title>

    <para>

      Por causa do número de configurações possíveis, a configuração de 
      volumes encriptados está além do escopo do livro BLFS.  Por favor, 
      veja-se o guia de configuração nas
<ulink url="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup">Perguntas Frequentes</ulink>
      do cryptsetup.

    </para>

  </sect2>

  <sect2 role="content">
    <title>Conteúdo</title>

    <segmentedlist>
      <segtitle>Aplicativos Instalados</segtitle>
      <segtitle>Biblioteca Instalada</segtitle>
      <segtitle>Diretórios Instalados</segtitle>

      <seglistitem>
        <seg>
          cryptsetup, cryptsetup-reencrypt, integritysetup e veritysetup
        </seg>
        <seg>
          libcryptsetup.so
        </seg>
        <seg>
          Nenhum
        </seg>
      </seglistitem>
    </segmentedlist>

    <variablelist>
      <bridgehead renderas="sect3">Descrições Curtas</bridgehead>
      <?dbfo list-presentation="list"?>
      <?dbhtml list-presentation="table"?>

      <varlistentry id="cryptsetup-prog">
        <term><command>cryptsetup</command></term>
        <listitem>

          <para>

            é usado para configurar mapeamentos de mapeador de 
            dispositivos gerenciados pelo dm-crypt

          </para>

          <indexterm zone="cryptsetup cryptsetup-prog">
            <primary sortas="b-cryptsetup">cryptsetup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="cryptsetup-reencrypt">
        <term><command>cryptsetup-reencrypt</command></term>
        <listitem>

          <para>

            é uma ferramenta para reencriptação offline de dispositivo 
            LUKS

          </para>

          <indexterm zone="cryptsetup cryptsetup-reencrypt">
            <primary sortas="b-cryptsetup-reencrypt">cryptsetup-reencrypt</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="integritysetup">
        <term><command>integritysetup</command></term>
        <listitem>

          <para>

            é uma ferramenta para gerenciar volumes do dm-integrity 
            (integridade em nível de bloco)

          </para>

          <indexterm zone="cryptsetup integritysetup">
            <primary sortas="b-integritysetup">integritysetup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

      <varlistentry id="veritysetup">
        <term><command>veritysetup</command></term>
        <listitem>

          <para>

            é usado para configurar mapeamentos de mapeador de 
            dispositivo gerenciados pelo dm-verity.  O alvo de 
            veracidade de mapeador de dispositivo fornece verificação de 
            integridade transparente somente leitura dos dispositivos de 
            bloco usando a API de criptografia do kernel

          </para>

          <indexterm zone="cryptsetup veritysetup">
            <primary sortas="b-veritysetup">veritysetup</primary>
          </indexterm>
        </listitem>
      </varlistentry>

    </variablelist>

  </sect2>

</sect1>
