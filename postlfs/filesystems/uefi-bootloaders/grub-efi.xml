<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../../general.ent">
  %general-entities;

  <!ENTITY grub-efi-download-http "https://ftp.gnu.org/gnu/grub/grub-&grub-version;.tar.xz">
  <!ENTITY grub-efi-download-ftp  "">
  <!ENTITY grub-efi-md5sum        "cf0fd928b1e5479c8108ee52cb114363">
  <!ENTITY grub-efi-size          "6,3 MB">
  <!ENTITY grub-efi-buildsize     "137 MB">
  <!ENTITY grub-efi-time          "1,0 UPC (no LFS de 64 bits)">

  <!ENTITY unifont-download-http  "https://unifoundry.com/pub/unifont/unifont-&unifont-version;/font-builds/unifont-&unifont-version;.pcf.gz">
  <!ENTITY unifont-md5sum         "c371b9b4a8a51228c468cc7efccec098">
  <!ENTITY unifont-size           "1,4 MB">

  <!ENTITY gcc-download-http      "&gnu-http;/gcc/gcc-&gcc-version;/gcc-&gcc-version;.tar.xz">
  <!ENTITY gcc-md5sum             "73bafd0af874439dcdb9fc063b6fb069">
  <!ENTITY gcc-size               "81 MB">
]>

<sect1 id="grub-efi" xreflabel="GRUB-&grub-version; para EFI">
  <?dbhtml filename="grub-efi.html"?>


  <title>GRUB-&grub-version; para EFI</title>

  <indexterm zone="grub-efi">
    <primary sortas="a-grub-efi">grub-efi</primary>
  </indexterm>

  <sect2 role="package">
    <title>Introdução ao GRUB</title>

    <para>
      O pacote <application>GRUB</application> fornece o GRand Unified
Bootloader. Nesta página, ele será construído com suporte UEFI, que não está
habilitado para o GRUB construído no LFS.
    </para>

    &lfs113_checked;

    <bridgehead renderas="sect3">Informação do Pacote</bridgehead>
    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&grub-efi-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Transferência (FTP): <ulink url="&grub-efi-download-ftp;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &grub-efi-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &grub-efi-size;
        </para>
      </listitem>
      <listitem>
        <para>
          Espaço em disco estimado exigido: &grub-efi-buildsize;
        </para>
      </listitem>
      <listitem>
        <para>
          Tempo de construção estimado: &grub-efi-time;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Transferências Adicionais</bridgehead>

    <itemizedlist spacing="compact">
      <listitem>
        <para>
          Remendo exigido: <ulink
url="&patch-root;/grub-&grub-version;-upstream_fixes-1.patch"/>
        </para>
      </listitem>
    </itemizedlist>

    <itemizedlist spacing="compact">
      <title>Dados de fonte Unicode usados para exibir o menu do GRUB</title>
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&unifont-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &unifont-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &unifont-size;
        </para>
      </listitem>
    </itemizedlist>

    <itemizedlist spacing="compact">
      <title>GCC (necessário somente se construir no LFS de 32 bits)</title>
      <listitem>
        <para>
          Transferência (HTTP): <ulink url="&gcc-download-http;"/>
        </para>
      </listitem>
      <listitem>
        <para>
          Soma de verificação MD5 da transferência: &gcc-md5sum;
        </para>
      </listitem>
      <listitem>
        <para>
          Tamanho da transferência: &gcc-size;
        </para>
      </listitem>
    </itemizedlist>

    <bridgehead renderas="sect3">Dependências do GRUB</bridgehead>

    <bridgehead renderas="sect4">Recomendadas</bridgehead>
    <para role="recommended">
      <xref role="runtime" linkend="efibootmgr"/> (tempo de execução) e <xref
linkend="freetype2"/>
    </para>

    <bridgehead renderas="sect4">Opcionais</bridgehead>
    <para role="optional">
      <xref linkend="lvm2"/>
    </para>

    <para condition="html" role="usernotes">Observações de Usuário(a): <ulink url="&blfs-wiki;/grub-efi"/></para>

  </sect2>

  <sect2 role="installation">
    <title>Instalação do GRUB</title>

    <para>
      Primeiro, instale os dados da fonte como o(a) usuário(a) <systemitem
class="username">root</systemitem>:
    </para>

<screen role="root"><userinput>mkdir -pv /usr/share/fonts/unifont &amp;&amp;
gunzip -c ../unifont-&unifont-version;.pcf.gz > /usr/share/fonts/unifont/unifont.pcf</userinput></screen>

    <warning>
      <para>Desconfigure quaisquer variáveis de ambiente que possivelmente afetem a
construção:</para>

      <screen><userinput>unset {C,CPP,CXX,LD}FLAGS</userinput></screen>

      <para>Não tente <quote>ajustar</quote> esse pacote com sinalizadores
personalizados de compilação: esse pacote é um carregador de inicialização,
com operações de baixo nível no código-fonte, as quais provavelmente sejam
quebradas por algumas otimizações agressivas.</para>
    </warning>

    <para>
      Corrija um problema que faz com que <command>grub-install</command> falhe
quando a partição <filename class='directory'>/boot</filename> (ou a
partição raiz, se <filename class='directory'>/boot</filename> não for uma
partição separada) é criada pelo e2fsprogs-1.47.0 ou posterior:
    </para>

<screen><userinput>patch -Np1 -i ../grub-&grub-version;-upstream_fixes-1.patch</userinput></screen>

    <para>Se você estiver executando um LFS de 32 bits, [então] prepare um compilador
de 64 bits:</para>


<screen><!-- 'literal' is used deliberately to show this is only for 32-bit LFS -->
<userinput>case $(uname -m) in i?86 )
    <literal>tar xf ../gcc-&gcc-version;.tar.xz
    mkdir gcc-&gcc-version;/build
    pushd gcc-&gcc-version;/build
        ../configure --prefix=$PWD/../../x86_64-gcc \
                     --target=x86_64-linux-gnu      \
                     --with-system-zlib             \
                     --enable-languages=c,c++       \
                     --with-ld=/usr/bin/ld
        make all-gcc
        make install-gcc
    popd
    export TARGET_CC=$PWD/x86_64-gcc/bin/x86_64-linux-gnu-gcc</literal>
esac</userinput></screen>

    <para>
      Construa o <application>GRUB</application> com os seguintes comandos:
    </para>

<screen><userinput>./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --disable-efiemu     \
            --enable-grub-mkfont \
            --with-platform=efi  \
            --target=x86_64      \
            --disable-werror     &amp;&amp;
unset TARGET_CC &amp;&amp;
make</userinput></screen>

    <para>
      Esse pacote não tem uma suíte de teste que forneça resultados
significativos.
    </para>

    <para>
      Agora, como o(a) usuário(a) <systemitem class="username">root</systemitem>:
    </para>

<screen role="root"><userinput>make install &amp;&amp;
mv -v /etc/bash_completion.d/grub /usr/share/bash-completion/completions</userinput></screen>

  </sect2>

  <sect2 role="commands">
    <title>Explicações do Comando</title>

    <para>
      <parameter>--enable-grub-mkfont</parameter>: Construa a ferramenta chamada
<command>grub-mkfont</command> para gerar o arquivo de fonte para o
carregador de inicialização a partir dos dados de fonte que instalamos.
    </para>

    <warning>
      <para>Se a dependência recomendada <xref linkend="freetype2"/> não estiver
instalada, [então] é possível omitir essa opção e construir o GRUB. No
entanto, se o <command>grub-mkfont</command> não fosse construído ou os
dados da fonte Unicode não estivessem disponíveis ao tempo que o GRUB for
construído, [então] o GRUB não instalaria nenhuma fonte para o carregador de
inicialização. O menu de inicialização do GRUB será exibido usando uma fonte
grosseira e o estágio inicial da inicialização do núcleo será em <quote>modo
cego</quote> &mdash; você não consegue ver nenhuma mensagem do núcleo antes
que o controlador da placa gráfica seja inicializado. Será muito difícil
diagnosticar alguns problemas de inicialização, especialmente se o
controlador gráfico for construído como módulo.</para>
    </warning>

    <para>
      <parameter>--with-platform=efi</parameter>: Garante a construção do GRUB com
EFI habilitado.
    </para>

    <para>
      <parameter>--target=x86_64</parameter>: Garante a construção do GRUB para
x86_64, mesmo se construir em um sistema LFS de 32 bits. A maioria dos
firmwares EFI em x86_64 não suporta carregadores de inicialização de 32
bits.
    </para>

    <para>
      <option>--target=i386</option>: Algumas plataformas x86 de 32 bits tem
suporte EFI. E algumas plataformas x86_64 tem uma implementação EFI de 32
bits, mas são muito antigas e raras. Use isso ao invés de
<parameter>--target=x86_64</parameter> se você estiver <emphasis
role='bold'>absolutamente seguro(a)</emphasis> de que o LFS está executando
em tal sistema.
    </para>

  </sect2>

  <sect2>
    <title>Configurando o GRUB</title>

    <para>
      Usar o GRUB para tornar o sistema LFS inicializável na plataforma UEFI será
discutido em <xref linkend="grub-setup"/>.
    </para>
  </sect2>

  <sect2 role="content">
    <title>Conteúdo</title>

    <para>Veja-se a página para o GRUB no livro LFS.</para>
  </sect2>

</sect1>
