<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
   "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../../general.ent">
  %general-entities;
]>

<sect1 id="xorg-config">
  <?dbhtml filename="xorg-config.html"?>


  <title>Testagem e Configuração do Xorg-&xorg-version;</title>

  <indexterm zone="xorg-config">
    <primary sortas="g-configuring-xorg">Configurando o <quote>Xorg</quote></primary>
  </indexterm>

  <sect2 id='X11-testing' xreflabel="Testando o Xorg">
    <title>Testando o Xorg</title>

    <note>
      <para>
        Antes de iniciar o &quot;Xorg&quot; pela primeira vez, é útil reconstruir o
&quot;cache&quot; da biblioteca executando-se o
&quot;<userinput>ldconfig</userinput>&quot; como o(a) usuário(a)
&quot;<systemitem class="username">root</systemitem>&quot;.
      </para>
    </note>

    <note>
      <para>
        Antes de iniciar o &quot;Xorg&quot; pela primeira vez, muitas vezes é
necessário reinicializar o sistema para garantir que todos os processos de
segundo plano apropriados sejam iniciados e que os problemas de segurança
apropriados estejam configurados adequadamente. Como alternativa, sair e
logar-se novamente possivelmente funcione, mas ao tempo deste texto, não foi
testado.
      </para>
    </note>

    <warning>
      <para>
        Se o &quot;Xorg&quot; travar por algum motivo (por exemplo, ausência de um
controlador de entrada adequado), [então] o sistema poderá parar de
responder a qualquer entrada gerada de usuário(a). Como precaução, você pode
habilitar uma tecla mágica &quot;<keycap>SysRq</keycap>&quot; antes de
testar o &quot;Xorg&quot;. Como o(a) usuário(a) &quot;<systemitem
class="username">root</systemitem>&quot;, emita:
      </para>

<screen><userinput>echo 4 > /proc/sys/kernel/sysrq</userinput></screen>

      <para>
        Então, se o &quot;Xorg&quot; travar, é possível usar &quot;<keycombo>
<keycap>Alt</keycap> <keycap>SysRq</keycap> <keycap>R</keycap>
</keycombo>&quot; para reconfigurar o modo do teclado. Agora ele deveria ser
capaz de usar &quot;<keycombo> <keycap>Ctrl</keycap> <keycap>Alt</keycap>
<keycap>Fx</keycap> </keycombo>&quot; (substitua o &quot;x&quot; por um
número de &quot;VT&quot;) para comutar para outro &quot;VT&quot;. Se
funcionar, [então] logue-se e mate o &quot;Xorg&quot; usando a linha de
comando no novo &quot;VT&quot;.
      </para>
    </warning>

    <para>
      Para testar a instalação do &quot;<application>Xorg</application>&quot;,
emita &quot;<command>startx</command>&quot;. Esse comando traz um
gerenciador de janelas rudimentar chamado
&quot;<emphasis>twm</emphasis>&quot; com três janelas do &quot;xterm&quot; e
uma janela do &quot;xclock&quot;. A janela do &quot;xterm&quot; no canto
superior esquerdo é um terminal de &quot;login&quot; e executar-se
&quot;<emphasis>exit</emphasis>&quot; a partir desse terminal sairá da
sessão do &quot;<application>Janelas X</application>&quot;. A terceira
janela do &quot;xterm&quot; possivelmente esteja obscurecida em teu sistema
pelos outros dois &quot;xterms&quot;.
    </para>

    <note>
      <para>
        <!--<filename revision="sysv">

        /var/log/Xorg.0.log</filename><filename revision="systemd">-->
<!--</filename>
-->
Ao testar o &quot;<application>Xorg</application>&quot; com o gerenciador de
janelas &quot;<application>twm</application>&quot;, existirão vários avisos
no arquivo de registro do &quot;Xorg&quot;,
&quot;$HOME/.local/share/xorg/Xorg.0.log&quot;, a respeito de arquivos de
fontes ausentes. Além disso, existirão vários avisos no terminal de modo
texto (geralmente &quot;tty1&quot;) a respeito de fontes ausentes. Esses
avisos não afetam a funcionalidade, mas podem ser removidos, se desejado,
instalando-se o &quot;<xref linkend="xorg7-legacy"/>&quot;.
      </para>
    </note>

    <para>
      Geralmente, não existe configuração específica exigida para o
&quot;<application>Xorg</application>&quot;, mas a personalização é
possível. Para detalhes, veja-se &quot;<xref linkend='xconfig'/>&quot;
abaixo.
    </para>

  </sect2>

  <sect2 role="configuration" id="checking-dri" xreflabel="Verificando a instalação do &quot;DRI&quot;">
    <title>Verificando a Instalação da <quote>Direct Rendering Infrastructure</quote>
(<quote>DRI</quote>)</title>

    <para>
      &quot;DRI&quot; é uma estrutura que permite que logiciário acesse
&quot;hardware&quot; gráfico de maneira segura e eficiente. Ela é instalada
no &quot;<application>X</application>&quot; por padrão (usando
&quot;<application>Mesa</application>&quot;) se você tiver uma placa de
vídeo suportada.
    </para>

    <para>
      Para verificar se os controladores da &quot;DRI&quot; estão instalados
adequadamente, verifique o arquivo de registro
&quot;<filename>$HOME/.local/share/xorg/Xorg.0.log</filename>&quot; (ou
&quot;<filename>/var/log/Xorg.0.log</filename>&quot; se você tiver
construído o &quot;<xref linkend="xorg-server"/>&quot; com o &quot;bit&quot;
&quot;suid&quot;) para declarações como:
    </para>

<screen><literal>(II) intel(0): direct rendering: DRI2 Enabled</literal></screen>

    <para>ou</para>

<screen><literal>(II) NOUVEAU(0): Loaded DRI module</literal></screen>

    <note>
      <para>
        A configuração da &quot;DRI&quot; possivelmente seja diferente se você
estiver usando controladores alternativos, como aqueles oriundos da
&quot;<ulink
url="https://www.nvidia.com/page/home.html">NVIDIA</ulink>&quot; ou da
&quot;<ulink url="https://www.amd.com/">AMD</ulink>&quot;.
      </para>
    </note>


    <!-- With elogind, this is not needed anymore
    <para>

      Although all users can use software acceleration, any hardware
      acceleration (DRI2) is only available to <systemitem
      class="username">root</systemitem> and members of the <systemitem
      class="groupname">video</systemitem> group, but
      <phrase revision="sysv"><emphasis>ConsoleKit2</emphasis></phrase>
      <phrase revision="systemd"><emphasis>systemd-logind</emphasis></phrase>
      takes care of adding any logged in user to the user ACL's of
      <filename>/dev/dri/card*</filename>, the special file(s) allowing access
      to hardware acceleration.<phrase revision="systemd"> So, no further
      configuration is needed.</phrase>
    </para>

    <para revision="sysv">
      If your driver is supported and <emphasis>ConsoleKit2</emphasis> is not
      installed, add any users that might use X to the <systemitem
      class="groupname">video</systemitem> group:
    </para>

<screen role="root" revision="sysv"><userinput>usermod -a -G video <replaceable>&lt;username&gt;</replaceable></userinput></screen>
-->
<para>
      Outra maneira de determinar se a &quot;DRI&quot; está funcionando
adequadamente é a de usar um dos dois aplicativos de demonstração
&quot;OpenGL&quot; instalados opcionalmente no &quot;<xref
linkend="mesa"/>&quot;. A partir de um terminal do &quot;X&quot;, execute
&quot;<command>glxinfo</command>&quot; e procure pela frase:
    </para>

<screen><computeroutput>nome da tela: :0
display: :0   screen: 0
direct rendering: Yes</computeroutput></screen>

    <para>
      Se a Renderização Direta estiver habilitada, [então] você poderá adicionar
detalhamento executando &quot;<command>LIBGL_DEBUG=verbose
glxinfo</command>&quot;. Isso mostrará os controladores, nós de dispositivos
e arquivos usados pelo sistema da &quot;DRI&quot;.
    </para>

    <para>
      Para confirmar se a aceleração de &quot;hardware&quot; &quot;DRI2&quot; está
funcionando, você pode (ainda no terminal do &quot;X&quot;) executar o
comando <command>glxinfo | grep -E "(OpenGL vendor|OpenGL renderer|OpenGL
version)"</command>. Se isso informar algo <emphasis>diferente de</emphasis>
&quot;<literal>Software Rasterizer</literal>&quot;, então você tem
aceleração funcional para o(a) usuário(a) que executou o comando.
    </para>

    <para>
      Se o teu &quot;hardware&quot; não tiver nenhum controlador &quot;DRI2&quot;
disponível, [então] ele usará um &quot;Software Rasterizer&quot; para
Renderização Direta. Nesses casos, você pode usar um novo &quot;Software
Rasterizador&quot;, acelerado por &quot;LLVM&quot;, chamado
&quot;LLVMPipe&quot;. Para a finalidade de construir o &quot;LLVMPipe&quot;,
apenas certifique-se de que o &quot;<xref linkend="llvm"/>&quot; esteja
presente ao tempo da construção do &quot;Mesa&quot;. Observe que toda a
decodificação é feita na &quot;CPU&quot; e não na &quot;GPU&quot;, de forma
que a exibição ficará mais lenta que com aceleração de
&quot;hardware&quot;. Para verificar se você está usando o
&quot;LLVMpipe&quot;, revise a saída gerada do comando &quot;glxinfo&quot;
acima. Um exemplo de saída gerada usando o &quot;Software Rasterizer&quot; é
mostrado abaixo:
    </para>

<screen><computeroutput>OpenGL vendor string: VMware, Inc.
OpenGL renderer string: Gallium 0.4 on llvmpipe (LLVM 3.5, 256 bits)
OpenGL version string: 3.0 Mesa 10.4.5</computeroutput></screen>

    <para>
      Você também consegue forçar o &quot;LLVMPipe&quot; exportando a variável de
ambiente &quot;<envar>LIBGL_ALWAYS_SOFTWARE=1</envar>&quot; ao iniciar o
&quot;Xorg&quot;.
    </para>

    <para>
      Novamente, se você tiver construído os demonstrativos &quot;OpenGL&quot; do
&quot;Mesa&quot;, [então] também poderá executar o aplicativo de teste
&quot;<command>glxgears</command>&quot;. Esse aplicativo abre uma janela com
três engrenagens girando. O terminal do &quot;X&quot; exibirá quantos
quadros foram desenhados a cada cinco segundos, de forma que isso dará uma
avaliação comparativa aproximada. A janela é escalonável e os quadros
desenhados por segundo são altamente dependentes do tamanho da janela. Em
alguns &quot;hardwares&quot;, o &quot;<command>glxgears</command>&quot;
executará sincronizado com o sinal de atualização vertical e a taxa de
quadros será aproximadamente a mesma que a taxa de atualização do monitor.
    </para>

  </sect2>

  <sect2 role="configuration" id="xorg-debug" xreflabel="Depurando o Xorg">
    <title>Depurando o Xorg</title>

    <para>
      Ao iniciar o &quot;Xorg&quot;, existem algumas maneiras de verificar
quaisquer problemas que você possa ter. Se o sistema funcionar, [então] você
poderá ver qual controlador está sendo usado executando o
&quot;<command>xdriinfo</command>&quot;. Se existirem problemas ou você
quiser apenas verificar, {então} consulte <filename>Xorg.0.log</filename>.
    </para>

    <para>
      O local do &quot;<filename>Xorg.0.log</filename>&quot; depende de como o
&quot;Xorg&quot; está instalado. Se as instruções no livro forem seguidas à
risca e o &quot;Xorg&quot; for iniciado a partir da linha de comando,
[então] ele estará localizado no diretório &quot;<filename
class="directory">$HOME/.local/share/xorg/</filename>&quot;. Se o
&quot;Xorg&quot; for iniciado por um gerenciador de exibição (por exemplo,
&quot;<xref linkend='lightdm'/>&quot;, &quot;<xref linkend='lxdm'/>&quot; ou
&quot;<xref linkend='gdm'/>&quot;) ou se
&quot;<filename>$XORG_PREFIX/libexec /Xorg</filename>&quot; tiver o
&quot;bit&quot; &quot;suid&quot; configurado, [então] ele estará localizado
no diretório &quot;<filename class="directory">/var/log/</filename>&quot;.
    </para>

    <bridgehead renderas="sect3">Problemas do &quot;Xorg.0.log&quot;</bridgehead>

    <para>
      Ao olhar para o &quot;Xorg.0.log&quot;, verifique entradas como
(&quot;EE&quot;) ou (&quot;WW&quot;). Abaixo estão algumas entradas comuns:
    </para>

    <bridgehead renderas="sect5">(WW) Open ACPI failed (/var/run/acpid.socket)</bridgehead>

    <para>
      Esse aviso ocorre porque o &quot;<xref linkend='acpid'/>&quot; não está
instalado. Se você não estiver em um &quot;laptop&quot;, [então] ele pode
ser seguramente ignorado. Em um &quot;laptop&quot;, instale o &quot;<xref
linkend='acpid'/>&quot; para habilitar ações como reconhecer quando a tampa
está fechada.
    </para>

    <bridgehead renderas="sect5">(WW) VGA arbiter: cannot open kernel arbiter, no multi-card support</bridgehead>

    <para>
      Esse aviso é exibido quando um(a) usuário(a) normal inicia o
&quot;Xorg&quot;. A biblioteca
&quot;<filename>libpciaccess.so</filename>&quot; emite esse aviso quando ela
tenta abrir o &quot;<filename>/dev/vga_arbiter</filename>&quot;. Se existir
somente uma placa de vídeo no sistema, [então] ele pode ser seguramente
ignorado. Se desejado, [então] as permissões desse dispositivo podem ser
mudadas adicionando-se uma regra do &quot;Udev&quot; e adicionando-se o(a)
usuário(a) local ao grupo de vídeo. Como o(a) usuário(a) &quot;&root;&quot;:
    </para>

<screen role="root"><userinput>cat > /etc/udev/rules.d/99-vga-arbiter.rules &lt;&lt; EOF
# /etc/udev/rules.d/99-vga-arbiter.rules: Configura grupo/modo do "vga_arbiter"

ACTION=="add", KERNEL=="vga_arbiter", GROUP="video" MODE="0660"
EOF

usermod -a -G video &lt;usuário(a) executando o Xorg&gt;</userinput></screen>

    <bridgehead renderas="sect5">(EE) AIGLX error: dlopen of /opt/xorg/lib/dri/i965_dri.so failed</bridgehead>

  <para>
    Esse erro, acompanhado por &quot;(EE) AIGLX error: unable to load driver
i965&quot;, ocorre em alguns sistemas com dispositivos gráficos baseados em
Intel. Isso é causado por uma incompatibilidade entre o &quot;<xref
linkend='xorg-server'/>&quot; e o &quot;<xref linkend='mesa'/>&quot;
atuais. O &quot;Xorg&quot; não mais usa o controlador &quot;i965&quot; e usa
os controladores Mesa &quot;crocus&quot; ou &quot;iris&quot;, conforme
indicado pelo comando &quot;<command>xdriinfo</command>&quot;. Ele pode
seguramente ser ignorado.
  </para>

  <para>
    Se desejado, [então] esse aviso pode ser removido comentando-se as linhas
330-331 e 337-338 (&quot;LogMessage&quot;) do
&quot;<filename>glx/glxdricommon.c</filename>&quot; no pacote &quot;<xref
linkend='xorg-server'/>&quot;.
  </para>

  </sect2>

  <sect2 role="configuration" id="hybrid-graphics" xreflabel="Gráficos Híbridos">
    <title>Gráficos Híbridos</title>

    <para>
      Os Gráficos Híbridos ainda estão em estado experimental para o Linux. Os(As)
desenvolvedores(as) do &quot;Xorg&quot; desenvolveram uma tecnologia chamada
&quot;PRIME&quot; que pode ser usada para comutar entre &quot;GPU&quot;
discreta integrada e sem &quot;mux&quot; à vontade. A comutação automática
não é possível no momento.
    </para>

    <para>
      Para a finalidade de usar a &quot;PRIME&quot; para comutação de
&quot;GPU&quot;, certifique-se de que está usando o Núcleo Linux 3.4 ou
posterior (recomendado). Você precisará dos controladores &quot;DRI&quot; e
&quot;DDX&quot; mais recentes para o teu &quot;hardware&quot; e do
<application>Servidor &quot;Xorg&quot;</application> 1.13 ou posterior.
    </para>

    <para>
      O <application>Servidor &quot;Xorg&quot;</application> deveria carregar
ambos os controladores de &quot;GPU&quot; automaticamente. Você pode
verificar isso executando:
    </para>

<screen><userinput>xrandr --listproviders</userinput></screen>

    <para>
      Deveria existir dois (ou mais) provedores listados, por exemplo:
    </para>

<screen><computeroutput>Providers: number : 2
Provider 0: id: 0x7d cap: 0xb, Source Output, Sink Output, Sink Offload crtcs: 3 outputs: 4 associated providers: 1 name:Intel
Provider 1: id: 0x56 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 6 outputs: 1 associated providers: 1 name:radeon</computeroutput></screen>

    <para>
      Para a finalidade de poder executar um aplicativo &quot;GLX&quot; em uma
&quot;GPU&quot; discreta, você precisará executar o seguinte comando, onde
&lt;provider&gt; é a placa discreta mais poderosa e &lt;sink&gt; é o cartão
que tem uma tela conectada:
    </para>

<screen><userinput>xrandr --setprovideroffloadsink <replaceable>&lt;provider&gt; &lt;sink&gt;</replaceable></userinput></screen>

    <note>
      <para>
        Com controladores do &quot;<application>Xorg</application>&quot; mais
recentes, como &quot;modesetting&quot; ou &quot;intel&quot;, que são
compatíveis com &quot;DRI3&quot;, o comando acima não mais é necessário. No
entanto, ele não danifica.
      </para>
    </note>

    <para>
      Então, você precisará exportar a variável de ambiente
&quot;<envar>DRI_PRIME=1</envar>&quot; toda vez que quiser que a poderosa
&quot;GPU&quot; seja usada. Por exemplo, <screen><userinput>DRI_PRIME=1 glxinfo | grep -E "(OpenGL vendor|OpenGL renderer|OpenGL version)"</userinput></screen>
mostrará o fornecedor, o renderizador e a versão do &quot;OpenGL&quot; para
a &quot;GPU&quot; discreta.
    </para>

    <para>
      Se o último comando informar o mesmo renderizador &quot;OpenGL&quot; com e
sem &quot;<envar>DRI_PRIME=1</envar>&quot;, [então] você precisará verificar
a tua instalação.
    </para>

  </sect2>

  <sect2 role="configuration" id='xconfig'>
    <title>Configurando Dispositivos do <quote>Xorg</quote></title>

    <para>
      Para a maioria das configurações de &quot;hardware&quot;, o &quot;Xorg&quot;
moderno corrigirá automaticamente a configuração do servidor sem qualquer
intervenção do(a) usuário(a). Existem, no entanto, alguns casos em que a
configuração automática estará incorreta. A seguir estão alguns de itens de
configuração manual de exemplo que possivelmente sejam de uso nesses casos.
    </para>

    <sect3 id="xinput">
      <title>Configurando Dispositivos de Entrada do <quote>X</quote></title>
      <para>
        Para a maioria dos dispositivos de entrada, nenhuma configuração adicional
será necessária. Esta seção é fornecida somente para fins informativos.
      </para>

      <para>
        Uma amostra de configuração padrão do &quot;XKB&quot; poderia ser semelhante
ao seguinte (executado como o(a) usuário(a) &quot;<systemitem
class="username">root</systemitem>&quot;):
      </para>

<screen role="root"><userinput>cat &gt; /etc/X11/xorg.conf.d/xkb-defaults.conf &lt;&lt; "EOF"
<literal>Section "InputClass"
     Identifier "XKB Defaults"
     MatchIsKeyboard "yes"
     Option "XkbLayout" "fr"
     Option "XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</literal>
EOF</userinput></screen>

      <para>
        A linha <quote>XkbLayout</quote> é um exemplo para um teclado francês
(&quot;AZERTY&quot;). Mude-a para o modelo do teu teclado. Essa linha não é
necessária para um teclado &quot;QWERTY&quot; (&quot;EUA&quot;).
      </para>
    </sect3>

    <sect3 id="xdisplay">
      <title>Configurações de Ajuste Fino de Exibição</title>

      <para>
        Novamente, com o &quot;Xorg&quot; moderno, pouca ou nenhuma configuração
adicional é necessária. Se devesse precisar de opções extras passadas para o
teu controlador de vídeo, por exemplo, você poderia usar algo como o
seguinte (novamente, executado como o(a) usuário(a) &quot;<systemitem
class="username">root</systemitem>&quot;):
      </para>

<screen role="root"><userinput>cat &gt; /etc/X11/xorg.conf.d/videocard-0.conf &lt;&lt; "EOF"
<literal>Section "Device"
    Identifier  "Videocard0"
    Driver      "radeon"
    VendorName  "Fornecedor da placa de vídeo"
    BoardName   "ATI Radeon 7500"
    Option      "NoAccel" "true"
EndSection</literal>
EOF</userinput></screen>

      <para>
        Outra configuração comum é ter vários esquemas de servidor para uso em
ambientes diferentes. Apesar de que o servidor automaticamente detectará a
presença de outro monitor, ele possivelmente obtenha a ordem incorreta:
      </para>

<screen role="root"><userinput>cat &gt; /etc/X11/xorg.conf.d/server-layout.conf &lt;&lt; "EOF"
<literal>Section "ServerLayout"
     Identifier     "DefaultLayout"
     Screen      0  "Screen0" 0 0
     Screen      1  "Screen1" LeftOf "Screen0"
     Option         "Xinerama"
EndSection</literal>
EOF</userinput></screen>

    </sect3>
  </sect2>
</sect1>
